<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAXIMUS 2.0 | NEURAL LINK</title>
    <!-- Cytoscape.js for the Neural Graph -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
    <!-- Tailwind CSS for Layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: JetBrains Mono & Orbitron -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-green: #0aff0a;
            --neon-red: #ff0a0a;
            --void-black: #050505;
            --glass-panel: rgba(10, 20, 30, 0.85);
            --grid-line: rgba(0, 243, 255, 0.1);
        }

        body {
            background-color: var(--void-black);
            color: var(--neon-cyan);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 243, 255, 0.05) 0%, transparent 50%),
                linear-gradient(0deg, rgba(0,0,0,1) 0%, rgba(5,10,15,1) 100%);
        }

        /* Cyberpunk Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #004444; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

        .orbitron { font-family: 'Orbitron', sans-serif; }
        
        .panel-border {
            border: 1px solid rgba(0, 243, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.05);
            backdrop-filter: blur(5px);
            background: var(--glass-panel);
        }

        .pulse-text { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { opacity: 1; text-shadow: 0 0 5px var(--neon-cyan); }
            50% { opacity: 0.5; text-shadow: none; }
            100% { opacity: 1; text-shadow: 0 0 5px var(--neon-cyan); }
        }

        .scanline {
            width: 100%;
            height: 2px;
            background: rgba(0, 243, 255, 0.1);
            position: absolute;
            z-index: 999;
            animation: scanline 6s linear infinite;
            pointer-events: none;
        }
        @keyframes scanline { 0% { top: 0%; } 100% { top: 100%; } }

        /* Status Bars */
        .bar-container { background: #112233; height: 6px; width: 100%; border-radius: 2px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.3s ease-out; }
        
        /* Terminal */
        #terminal-output {
            font-size: 0.85rem;
            line-height: 1.4;
        }
        .log-entry { margin-bottom: 4px; border-left: 2px solid transparent; padding-left: 8px; }
        .log-info { border-color: var(--neon-cyan); color: #aaddff; }
        .log-warn { border-color: #ffaa00; color: #ffcc00; }
        .log-error { border-color: var(--neon-red); color: #ff5555; }
        .log-thought { border-color: var(--neon-green); color: #88ff88; font-style: italic; }

        /* Matrix Grid Animation */
        .matrix-grid {
            background-size: 40px 40px;
            background-image:
                linear-gradient(to right, var(--grid-line) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-line) 1px, transparent 1px);
            perspective: 500px;
        }
        
        .agent-blip {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--neon-cyan);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--neon-cyan);
            transition: all 1s ease-in-out;
            cursor: pointer;
        }
        .agent-blip:hover::after {
            content: attr(data-id);
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: black;
            border: 1px solid var(--neon-cyan);
            padding: 2px 5px;
            font-size: 10px;
            white-space: nowrap;
            z-index: 10;
        }
        .agent-blip.danger { background: var(--neon-red); box-shadow: 0 0 15px var(--neon-red); }

        /* Layout Modes */
        #view-simple { display: none; }
        #view-dash { display: flex; } /* Default */
        #view-matrix { display: none; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <div class="scanline"></div>

    <!-- HEADER -->
    <header class="h-16 border-b border-cyan-900 flex items-center justify-between px-6 bg-opacity-90 bg-black z-50">
        <div class="flex items-center gap-4">
            <div class="w-8 h-8 border border-cyan-500 rounded-full flex items-center justify-center animate-spin-slow">
                <div class="w-2 h-2 bg-cyan-400 rounded-full"></div>
            </div>
            <div>
                <h1 class="orbitron text-xl tracking-widest text-white">MAXIMUS <span class="text-cyan-400">2.0</span></h1>
                <div class="text-xs text-cyan-600 flex gap-2">
                    <span>STATUS: <span class="text-green-400 pulse-text">ONLINE</span></span>
                    <span>|</span>
                    <span>ERA: <span class="text-yellow-500">DEC 2025</span></span>
                </div>
            </div>
        </div>

        <!-- Mode Switcher -->
        <div class="flex gap-2">
            <button onclick="switchView('simple')" class="nav-btn px-4 py-1 border border-cyan-800 hover:bg-cyan-900 hover:text-white transition-colors text-xs uppercase rounded">Neural Pulse</button>
            <button onclick="switchView('dash')" class="nav-btn px-4 py-1 border border-cyan-500 bg-cyan-900 text-white transition-colors text-xs uppercase rounded shadow-[0_0_10px_rgba(0,243,255,0.3)]">Command Center</button>
            <button onclick="switchView('matrix')" class="nav-btn px-4 py-1 border border-cyan-800 hover:bg-cyan-900 hover:text-white transition-colors text-xs uppercase rounded">Tactical Matrix</button>
        </div>
    </header>

    <!-- VIEW 1: NEURAL PULSE (SIMPLE) -->
    <main id="view-simple" class="flex-1 flex flex-col items-center justify-center p-12 gap-12 relative hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
        
        <div class="w-full max-w-4xl panel-border p-8 rounded-xl bg-black bg-opacity-50">
            <h2 class="orbitron text-2xl mb-6 text-center text-cyan-300">SYSTEM HOMEOSTASIS</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div class="text-4xl font-bold mb-2 text-green-400" id="pulse-coherence">99.3%</div>
                    <div class="text-xs tracking-widest text-cyan-600">COHERENCE (r)</div>
                    <div class="bar-container mt-2"><div class="bar-fill bg-green-500" style="width: 99%"></div></div>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold mb-2 text-cyan-400" id="pulse-load">142ms</div>
                    <div class="text-xs tracking-widest text-cyan-600">HCL LOOP LATENCY</div>
                    <div class="bar-container mt-2"><div class="bar-fill bg-cyan-500" style="width: 30%"></div></div>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold mb-2 text-purple-400" id="pulse-consciousness">LEVEL 4</div>
                    <div class="text-xs tracking-widest text-cyan-600">AWARENESS STAGE</div>
                    <div class="bar-container mt-2"><div class="bar-fill bg-purple-500" style="width: 80%"></div></div>
                </div>
            </div>
        </div>
    </main>

    <!-- VIEW 2: COMMAND CENTER (DASH) -->
    <main id="view-dash" class="flex-1 p-4 gap-4 overflow-hidden h-full flex">
        
        <!-- LEFT COL: TERMINAL & THOUGHTS (30%) -->
        <section class="w-1/3 flex flex-col gap-4">
            <div class="panel-border rounded-lg flex-1 flex flex-col overflow-hidden bg-black">
                <div class="bg-cyan-900 bg-opacity-20 px-3 py-1 text-xs border-b border-cyan-800 flex justify-between items-center">
                    <span class="font-bold">TERMINAL://MAXIMUS/CORE</span>
                    <div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-red-500"></div><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div>
                </div>
                <div id="terminal-output" class="flex-1 p-3 overflow-y-auto font-mono text-cyan-300">
                    <!-- Logs injected by JS -->
                </div>
            </div>

            <div class="panel-border rounded-lg h-1/3 p-3">
                <h3 class="text-xs font-bold text-gray-400 mb-2 uppercase border-b border-gray-800 pb-1">Thread Parallelization</h3>
                <div class="flex flex-col gap-2" id="threads-container">
                    <!-- Thread bars injected by JS -->
                </div>
            </div>
        </section>

        <!-- CENTER COL: KNOWLEDGE GRAPH (45%) -->
        <section class="w-5/12 flex flex-col relative panel-border rounded-lg bg-black">
            <div class="absolute top-2 left-3 z-10">
                <h3 class="orbitron text-sm text-cyan-500">NEURAL TOPOLOGY</h3>
                <div class="text-[10px] text-gray-500">LIVE VIEW: TIG / ESGT / MMEI</div>
            </div>
            <div id="cy" class="w-full h-full"></div>
            <div class="absolute bottom-2 right-3 text-[10px] text-gray-500 bg-black bg-opacity-80 p-2 rounded border border-gray-800">
                <span class="text-green-400">‚óè</span> Active
                <span class="text-red-400 ml-2">‚óè</span> Blocked
                <span class="text-blue-400 ml-2">‚óè</span> Idle
            </div>
        </section>

        <!-- RIGHT COL: CHAT & PERSONA (25%) -->
        <section class="w-1/4 flex flex-col gap-4">
            <div class="panel-border rounded-lg h-1/4 p-4 flex flex-col items-center justify-center relative overflow-hidden">
                <div class="absolute inset-0 bg-blue-900 bg-opacity-10 animate-pulse"></div>
                <div class="w-20 h-20 border-2 border-cyan-400 rounded-full flex items-center justify-center mb-2 shadow-[0_0_20px_rgba(0,243,255,0.4)]">
                    <div class="text-3xl">üß†</div>
                </div>
                <h3 class="orbitron text-lg text-white">MAXIMUS</h3>
                <p class="text-xs text-cyan-400">STATE: <span id="persona-state">DEEP THINKING</span></p>
            </div>

            <div class="panel-border rounded-lg flex-1 flex flex-col overflow-hidden bg-gray-900">
                <div class="bg-gray-800 px-3 py-2 text-xs border-b border-gray-700 font-bold text-gray-300">
                    INTERACTION PROTOCOL
                </div>
                <div id="chat-history" class="flex-1 p-3 overflow-y-auto space-y-3">
                    <div class="text-xs text-gray-500 text-center my-2">-- Session Started --</div>
                    <div class="flex flex-col items-start"><span class="bg-gray-800 text-gray-300 px-2 py-1 rounded text-xs">System ready. Awaiting directives.</span></div>
                </div>
                <div class="p-2 border-t border-gray-700 bg-gray-900">
                    <input type="text" id="chat-input" placeholder="Enter command..." class="w-full bg-black border border-gray-700 rounded px-2 py-1 text-sm text-cyan-400 focus:outline-none focus:border-cyan-500">
                </div>
            </div>
        </section>
    </main>

    <!-- VIEW 3: TACTICAL MATRIX (AGENTS) -->
    <main id="view-matrix" class="flex-1 p-6 gap-6 relative hidden bg-black">
        <!-- Grid Background -->
        <div class="absolute inset-0 matrix-grid opacity-30"></div>
        
        <!-- Sidebar Info -->
        <div class="w-64 panel-border h-full p-4 z-10 bg-black bg-opacity-80">
            <h3 class="orbitron text-cyan-400 mb-4">ACTIVE AGENTS</h3>
            <div id="agent-list" class="space-y-2 text-xs font-mono">
                <!-- Agent list injected by JS -->
            </div>
            <div class="mt-8 pt-4 border-t border-cyan-900">
                <h4 class="text-gray-500 text-[10px] mb-2">MATRIX LEGEND</h4>
                <div class="flex items-center gap-2 mb-1"><div class="w-2 h-2 bg-cyan-400 rounded-full"></div> <span>Stable</span></div>
                <div class="flex items-center gap-2 mb-1"><div class="w-2 h-2 bg-red-500 rounded-full"></div> <span>High Risk</span></div>
                <div class="flex items-center gap-2"><div class="w-2 h-2 bg-yellow-400 rounded-full"></div> <span>Busy</span></div>
            </div>
        </div>

        <!-- The Map -->
        <div class="flex-1 relative border border-cyan-900 rounded bg-gray-900 bg-opacity-20 overflow-hidden" id="matrix-container">
            <!-- Axes Labels -->
            <div class="absolute top-2 left-1/2 -translate-x-1/2 text-xs text-gray-500">COGNITIVE LOAD (Stress)</div>
            <div class="absolute left-2 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-gray-500">TASK COMPLEXITY</div>
            
            <!-- Crosshair Center -->
            <div class="absolute top-1/2 left-0 w-full h-[1px] bg-cyan-900"></div>
            <div class="absolute left-1/2 top-0 w-[1px] h-full bg-cyan-900"></div>

            <!-- Agents -->
            <!-- Injected by JS -->
        </div>
    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. VIEW SWITCHING ---
        function switchView(mode) {
            document.querySelectorAll('main').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('main').forEach(el => el.classList.remove('flex'));
            
            const target = document.getElementById(`view-${mode}`);
            target.classList.remove('hidden');
            target.classList.add('flex');
            
            // Update buttons state
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.innerText.toLowerCase().includes(mode.split('-')[0])) {
                    btn.classList.add('bg-cyan-900', 'border-cyan-500', 'shadow-[0_0_10px_rgba(0,243,255,0.3)]');
                    btn.classList.remove('border-cyan-800');
                } else {
                    btn.classList.remove('bg-cyan-900', 'border-cyan-500', 'shadow-[0_0_10px_rgba(0,243,255,0.3)]');
                    btn.classList.add('border-cyan-800');
                }
            });

            if(mode === 'dash') {
                cy.resize(); 
                cy.fit();
            }
        }

        // --- 2. CYTOSCAPE GRAPH ---
        const cy = cytoscape({
            container: document.getElementById('cy'),
            style: [
                { selector: 'node', style: { 'background-color': '#112233', 'label': 'data(label)', 'color': '#00f3ff', 'font-size': '10px', 'font-family': 'JetBrains Mono', 'border-width': 2, 'border-color': '#00f3ff', 'width': 40, 'height': 40, 'text-valign': 'bottom', 'text-margin-y': 5 } },
                { selector: 'edge', style: { 'width': 1, 'line-color': '#005555', 'target-arrow-color': '#005555', 'target-arrow-shape': 'triangle', 'curve-style': 'bezier' } },
                { selector: '.active', style: { 'background-color': '#00f3ff', 'line-color': '#00f3ff', 'target-arrow-color': '#00f3ff', 'transition-property': 'background-color, line-color, target-arrow-color', 'transition-duration': '0.3s' } },
                { selector: ':parent', style: { 'background-opacity': 0.1, 'background-color': '#ffffff', 'border-color': '#333', 'label': 'data(id)', 'text-valign': 'top', 'color': '#666' } }
            ],
            layout: { name: 'cose', animate: false }
        });

        const nodes = [
            { data: { id: 'core', label: 'Maximus Core' }, classes: 'center' },
            { data: { id: 'gateway', label: 'API Gateway' } },
            { data: { id: 'consciousness', label: 'Consciousness' } },
            { data: { id: 'reflector', label: 'Reflector', parent: 'consciousness' } },
            { data: { id: 'esgt', label: 'ESGT', parent: 'consciousness' } },
            { data: { id: 'tig', label: 'TIG', parent: 'consciousness' } },
            { data: { id: 'hcl', label: 'HCL Loop' } },
            { data: { id: 'monitor', label: 'Monitor', parent: 'hcl' } },
            { data: { id: 'analyzer', label: 'Analyzer', parent: 'hcl' } },
            { data: { id: 'planner', label: 'Planner', parent: 'hcl' } },
            { data: { id: 'executor', label: 'Executor', parent: 'hcl' } },
            { data: { id: 'memory', label: 'Episodic Memory' } }
        ];
        const edges = [
            { data: { source: 'gateway', target: 'core' } },
            { data: { source: 'core', target: 'consciousness' } },
            { data: { source: 'consciousness', target: 'hcl' } },
            { data: { source: 'reflector', target: 'memory' } },
            { data: { source: 'esgt', target: 'tig' } },
            { data: { source: 'monitor', target: 'analyzer' } },
            { data: { source: 'analyzer', target: 'planner' } },
            { data: { source: 'planner', target: 'executor' } },
            { data: { source: 'executor', target: 'monitor' } }, 
            { data: { source: 'planner', target: 'reflector' } }
        ];
        cy.add([...nodes.map(n => ({ group: 'nodes', ...n })), ...edges.map(e => ({ group: 'edges', ...e }))]);
        cy.layout({ name: 'cose', padding: 50, nodeRepulsion: 4500 }).run();

        // --- 3. TACTICAL MATRIX SIMULATION ---
        const agents = [
            { id: 'OSINT-01', type: 'scout', x: 20, y: 30, status: 'active' },
            { id: 'SEC-04', type: 'guard', x: 50, y: 50, status: 'stable' },
            { id: 'CODE-09', type: 'worker', x: 80, y: 70, status: 'high-load' },
            { id: 'NET-02', type: 'scout', x: 40, y: 20, status: 'active' }
        ];

        function renderMatrix() {
            const container = document.getElementById('matrix-container');
            const list = document.getElementById('agent-list');
            
            // Clear current positions (simulating movement traces could be cool later)
            container.innerHTML = `
                <div class="absolute top-2 left-1/2 -translate-x-1/2 text-xs text-gray-500">COGNITIVE LOAD</div>
                <div class="absolute left-2 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-gray-500">TASK COMPLEXITY</div>
                <div class="absolute top-1/2 left-0 w-full h-[1px] bg-cyan-900"></div>
                <div class="absolute left-1/2 top-0 w-[1px] h-full bg-cyan-900"></div>
            `;
            list.innerHTML = '';

            agents.forEach(agent => {
                // Simulate drift
                agent.x += (Math.random() - 0.5) * 2;
                agent.y += (Math.random() - 0.5) * 2;
                // Clamp
                agent.x = Math.max(5, Math.min(95, agent.x));
                agent.y = Math.max(5, Math.min(95, agent.y));

                const color = agent.status === 'high-load' ? 'danger' : '';
                
                // Map Element
                const el = document.createElement('div');
                el.className = `agent-blip ${color}`;
                el.style.left = `${agent.x}%`;
                el.style.bottom = `${agent.y}%`; // Y axis is complexity (bottom to top)
                el.setAttribute('data-id', agent.id);
                container.appendChild(el);

                // List Element
                list.innerHTML += `
                    <div class="flex justify-between border-b border-gray-800 pb-1">
                        <span class="${agent.status === 'high-load' ? 'text-red-400' : 'text-cyan-300'}">${agent.id}</span>
                        <span class="text-gray-500">[${Math.round(agent.x)}, ${Math.round(agent.y)}]</span>
                    </div>
                `;
            });
        }

        // --- 4. GLOBAL LOOP ---
        function log(msg, type='info') {
            const term = document.getElementById('terminal-output');
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString('en-US', {hour12: false});
            div.className = `log-entry log-${type}`;
            div.innerHTML = `<span class="text-gray-600">[${time}]</span> ${msg}`;
            term.appendChild(div);
            term.scrollTop = term.scrollHeight;
        }

        const thoughts = [
            "Analyzing semantic entropy of input...",
            "TIG synchronization: +0.4ms drift corrected.",
            "ESGT Ignition: Phase 3 (Broadcast) active.",
            "Veritas Judge: Hallucination score 0.02 (PASS).",
            "Sophia Judge: Context depth insufficient. Querying Memory...",
            "HCL: CPU load spike on node-3. Auto-scaling...",
            "Reflecting on previous task execution...",
            "Optimizing neuronal weights for new intent..."
        ];

        setInterval(() => {
            // Random Thought
            if(Math.random() > 0.6) {
                const t = thoughts[Math.floor(Math.random() * thoughts.length)];
                log(t, 'thought');
            }
            // Pulse Graph
            const randomNode = cy.nodes()[Math.floor(Math.random() * cy.nodes().length)];
            randomNode.addClass('active');
            setTimeout(() => randomNode.removeClass('active'), 500);
            
            // Update Matrix
            renderMatrix();
            // Update Threads
            updateThreads();
        }, 800);

        function updateThreads() {
            const container = document.getElementById('threads-container');
            container.innerHTML = '';
            const services = ['HCL Monitor', 'Veritas Engine', 'SimuRA World', 'Gateway'];
            services.forEach(svc => {
                const load = Math.floor(Math.random() * 60) + 20; 
                const color = load > 70 ? 'bg-red-500' : 'bg-cyan-600';
                container.innerHTML += `<div><div class="flex justify-between text-[10px] text-gray-400 mb-1"><span>${svc}</span><span>${load}%</span></div><div class="bar-container h-1 bg-gray-800"><div class="bar-fill ${color}" style="width: ${load}%"></div></div></div>`;
            });
        }

        document.getElementById('chat-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                const txt = this.value;
                const history = document.getElementById('chat-history');
                history.innerHTML += `<div class="flex flex-col items-end"><span class="bg-cyan-900 text-cyan-100 px-3 py-1 rounded-bl-lg rounded-tl-lg rounded-tr-lg text-xs max-w-[90%]">${txt}</span></div>`;
                this.value = '';
                setTimeout(() => {
                    log(`Processing user intent: "${txt}"`, 'info');
                    history.innerHTML += `<div class="flex flex-col items-start"><span class="bg-gray-800 text-gray-300 px-3 py-1 rounded-br-lg rounded-tl-lg rounded-tr-lg text-xs max-w-[90%] animate-pulse">Thinking...</span></div>`;
                    setTimeout(() => {
                        history.lastElementChild.innerHTML = `<span class="bg-gray-800 text-gray-300 px-3 py-1 rounded-br-lg rounded-tl-lg rounded-tr-lg text-xs max-w-[90%]">Command received. Initiating execution protocol via HCL. Safety checks passed.</span>`;
                        log("Action dispatched to Executor.", 'warn');
                    }, 1500);
                    history.scrollTop = history.scrollHeight;
                }, 500);
            }
        });

        // Initialize Simple View with Mock Data
        setInterval(() => {
            const coherence = (99 + Math.random()).toFixed(1);
            document.getElementById('pulse-coherence').innerText = coherence + '%';
        }, 2000);

        // Initial setup
        switchView('dash'); // Set default view
    </script>
</body>
</html>
